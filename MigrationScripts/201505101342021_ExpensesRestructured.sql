IF object_id(N'[dbo].[FK_dbo.Transactions_dbo.Groups_GroupId]', N'F') IS NOT NULL
    ALTER TABLE [dbo].[Transactions] DROP CONSTRAINT [FK_dbo.Transactions_dbo.Groups_GroupId]
IF object_id(N'[dbo].[FK_dbo.TransactionApplicationUsers_dbo.Transactions_Transaction_TransactionId]', N'F') IS NOT NULL
    ALTER TABLE [dbo].[TransactionApplicationUsers] DROP CONSTRAINT [FK_dbo.TransactionApplicationUsers_dbo.Transactions_Transaction_TransactionId]
IF object_id(N'[dbo].[FK_dbo.TransactionApplicationUsers_dbo.AspNetUsers_ApplicationUser_Id]', N'F') IS NOT NULL
    ALTER TABLE [dbo].[TransactionApplicationUsers] DROP CONSTRAINT [FK_dbo.TransactionApplicationUsers_dbo.AspNetUsers_ApplicationUser_Id]
IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_GroupId' AND object_id = object_id(N'[dbo].[Transactions]', N'U'))
    DROP INDEX [IX_GroupId] ON [dbo].[Transactions]
IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Transaction_TransactionId' AND object_id = object_id(N'[dbo].[TransactionApplicationUsers]', N'U'))
    DROP INDEX [IX_Transaction_TransactionId] ON [dbo].[TransactionApplicationUsers]
IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_ApplicationUser_Id' AND object_id = object_id(N'[dbo].[TransactionApplicationUsers]', N'U'))
    DROP INDEX [IX_ApplicationUser_Id] ON [dbo].[TransactionApplicationUsers]
CREATE TABLE [dbo].[Expenses] (
    [ExpenseId] [int] NOT NULL IDENTITY,
    [UserPayingId] [nvarchar](max) NOT NULL,
    [Description] [nvarchar](max) NOT NULL,
    [Date] [datetime] NOT NULL,
    [Amount] [float] NOT NULL,
    [GroupId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.Expenses] PRIMARY KEY ([ExpenseId])
)
CREATE INDEX [IX_GroupId] ON [dbo].[Expenses]([GroupId])
CREATE TABLE [dbo].[ExpenseApplicationUsers] (
    [Expense_ExpenseId] [int] NOT NULL,
    [ApplicationUser_Id] [nvarchar](128) NOT NULL,
    CONSTRAINT [PK_dbo.ExpenseApplicationUsers] PRIMARY KEY ([Expense_ExpenseId], [ApplicationUser_Id])
)
CREATE INDEX [IX_Expense_ExpenseId] ON [dbo].[ExpenseApplicationUsers]([Expense_ExpenseId])
CREATE INDEX [IX_ApplicationUser_Id] ON [dbo].[ExpenseApplicationUsers]([ApplicationUser_Id])
DROP TABLE [dbo].[Transactions]
DROP TABLE [dbo].[TransactionApplicationUsers]
ALTER TABLE [dbo].[Expenses] ADD CONSTRAINT [FK_dbo.Expenses_dbo.Groups_GroupId] FOREIGN KEY ([GroupId]) REFERENCES [dbo].[Groups] ([GroupId]) ON DELETE CASCADE
ALTER TABLE [dbo].[ExpenseApplicationUsers] ADD CONSTRAINT [FK_dbo.ExpenseApplicationUsers_dbo.Expenses_Expense_ExpenseId] FOREIGN KEY ([Expense_ExpenseId]) REFERENCES [dbo].[Expenses] ([ExpenseId]) ON DELETE CASCADE
ALTER TABLE [dbo].[ExpenseApplicationUsers] ADD CONSTRAINT [FK_dbo.ExpenseApplicationUsers_dbo.AspNetUsers_ApplicationUser_Id] FOREIGN KEY ([ApplicationUser_Id]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201505101342021_ExpensesRestructured', N'DataAccessLayer.Migrations.Configuration',  0x1F8B0800000000000400DD1DD96EE4B8F13D40FE41E8A764E175FBC80C26467B175E1F1B23E303D39E45DE0C5AA2DBC2E8E895A8591BC17ED93EE493F20B2175932C4AA4A49634C1008369912C168B55AC83AC9AFFFEF19FD58FAFBE677DC551EC86C1E9E270FF6061E1C00E1D37D89C2E12F2FCFD87C58F3FFCF94FAB4BC77FB57E29FA1DB37E7464109F2E5E08D99E2C97B1FD827D14EFFBAE1D8571F84CF6EDD05F22275C1E1D1CFC7D7978B8C414C482C2B2ACD5A72420AE8FD31FF4E77918D8784B12E4DD840EF6E2FC3B6D59A750AD5BE4E3788B6C7CBAB840049DD9368EE38FE80D470BEBCC731145638DBDE785858220248850244F3EC7784DA230D8ACB7F403F21EDEB698F67B465E8C73E44FAAEEBAEB383862EB5856030B50761293D0370478789C1366290EEF44DE4549384ABA4B4A62F2C6569D92EF74F1731426DB8525CE7472EE45AC9744DAFD14828BE3FDCBD72D0E621C5FD0716EB09F02DAB384EE7B257B502E627FF6ACF3C42349844F039C9008797BD67DF2E4B9F63FF1DB43F80507A741E279759C29D6B48DFB403FDD47E11647E4ED137EAEAFE4DA59584B7EF0521C5D8E1507660BBE0EC8F1D1C2BAA568A0270F97CC5123CE9A8411FE19073842043BF788101CD1BDBD76704A5E09056142F677311BE5462A550BEB06BD7EC4C186BC50793BA07274E5BE62A7F89263F03970A910D241244A308061F3AC6B6C479834CC4BFF39C8BCB7E8ABBB490925607083FD27CA0D0BEB13F6D2F6F8C5DD6642BA7FB6DD522648BF52198D1ED34DA15DAFA2D0FF14B2C9E01E8F0F28DAA4CB0A1BBBADC324B2055C57CB4A1C1A854480D9495C0418534A4A1721A9E403E2D8A30FBBE0D84B7AB0780DD31EBD7BAF35ADC62C54D93CBB918FCB55FE14526E428131CEF7288E7F0B23E71F287E1940D65A453A8928ABAE09F2B73B9FEDFE250CF06DC26478CCB906DB9A87DFC22B64D3A3FB3260A37AC3FB18DA5FC2845C060E1565FC99D80540F6F3C1F5F5010C824E76965C5166C6CE79486DA93685D60C8E1D522D8A4A57FE3A2B8C730FB9BE9EBE28BAAAF545D6A354042A7D91772BD48A2EAA853504229B373EDEA388B8B6BB4501E15085DA25C5067682D45A139A855A1D5203B7515450D4BAA87E0C376EA0876AD1558D6AD6A315D5BC9B29AA0C981EA6794F35A26987563CB35E109ADA364D61AC327829CF37593537A58371166F6F31D92F4667F6CDDB55446152B5F7655F02BB67690FAE4CA0235D13E8F8F0E9F9F8C3BBF7C8397EFF377CFC6E7C7368F7EE0223E514E657BA7D6CD29D6BFB74A65F90970C3D95B634E487EB108E70FE734A033F47A10B63D7868EC9DFF7E88DEE7723970FE59E0AB35FE0D88EDC6D165E197D724A30D96A3435FCFCBAB57711521E3207A2190431B2331A6DA1BC876C04A50D9206E45B4D15346F780D65A1A97004CDB8DE4A3AB54D8657D229D8F92BE9144DFAF9ABEB30F773D93EA2E84CC16BF52FD4ACE989296036B696E69639F6E4E398269DC48589E4F0D2C2A0CE5F58605606BBB20575E1FAA98CD202DF9971DCF0DCF66D70DAB7124A9E3A92C5C405B63CEAFBFD9877ABEC0EB955B23A802E2636C7591C87B69B6205DF7614A1357EA5978163E9C5D9329A03C110BA0394435DF68DE245B77E21F2DB5D70813D4CB0756667B7A7E728B69123D39DAECD31C4AF0CAF55F80121111EC3EFA489A924E0888D42EC0A21A672E60644161B3760E6A0A7453161B4A6D8312294F3882D17981AA66C715A24D14140A96196E55CC20EB5516AB5AC71623383F22E846ADF15FE44B5DDA5CFDFB6C92A98000BE55ECD0E19BB13C78178EBECB3E252DD88DBC08DE839F9885CC6B9846D8C01FB8783F01C7C39A07DBA7E27AA036D42282E0674CF5BF196A02BC63A93E84AE470C4C8AF1E74F114EF21E6A61C850B108572CC4311A328479E621328479E24B3578EF08D93EEFE0BD74F73634FFEDE4BC19D992F360A7372E49A8037397ACC9E35015747B5F14D7E8FBCEBD08EEF88231BBCADF1D9514DA51178514D099DC9E1B8D34E1831F37BE9184247E0483E272F9E58237E254004872E2C0FE2C4791040E40C067C8D89F0C0A272B6793B44B268F8E17900401A2D1DBF2D70245716020AF8BB2D60AB572E12B0D2B235C0AC78B7D188596E6C1880CD1F593442CDA4B205681B2010488D0B2B48AAE74AB5CECD0F9B4431D18EBF946B2A994B1239ED58490D16C460E231CA5342834AC2DDA04C9C06CF5FC3F7AFA15F31720335606FBF06A510F6C116CE5F3FAAD7AFF649F5BDD2AED400FDD0362EEB4013D57BB47691811C541317B597C8089EE82EB845F5FCAD9D3290B76AE2AFF6A28CE05B2A0E9362318353293FCCDB8904784C063E532F12F1FE8D8242F9427A1308BA7990A9D366B4EB9AEDB5C5800BD0B5B207224A711D529A8565DB6A99E597E51F564B4522DAEA066DB76EB0A925A6E55FAC75969576FEFDDA3C63CBCF602C6D8ECEA2115BCE44C2086DB0D04AA7A6985EB9514CD823B427C4ECB273C797BA8146B0C2262AA6E4EC5C790B0B53A9E8CEFE5D3E76E21ED0814ABCA2E2155D98CFDC8DF47999788ECAE32C9618883C14A95E369D875EE2072DA165359CEC0AB10E24FBA20FA1C8C0AAC328BEC950564B811092A724115B7263F9ADD3DA589588EBEFABE8AB98EF702B041585C56D36DBE13CDFA80E20FF6408A396B22201ABB5E943E5B38AEA30F916235EACA70E092C596F32C0B29E20C421596FE8044F4151B887FE0C724A501DBADCAA0F19480EAA83069A3BC0067016DBF4A102F94375C040B33EEC2A99A80EB2FA3A9BD30F706BFB1C857284C5FC30D480B19BE3B088158B5B6606A59645500754FB6C082BCF139080E5DF67C34AA553DD87818AA89A39DB28472A3557F5F29F535AAA5C8236D6A99EF48B0C54B5E843E49EE9D701720D06F0D297F71CA0F48BC179E90387A46F7A329A5AA73338179541846EE76216DFED772E2A60A81528F7649BD79F8DEFCCD530B977D89C8DD2F40E5D0DCFECF49D015BA8C226DDB8220DADF7630A18C46EB55D71AD5587A2BAEA9A6CD786DBA99EBB64B643FDAC197DF77DD7BBC2C7A440A341B80868B50F84FE0A5BA0C5AD66F137D826002F1064BA75302B1E1BCC8BF41EBE80D61157E58DB4168789E159332CC5E8A33133A86E40B4432FE58896008BF23A4D34791AEF4D2621B2099E66CCA0B6CC1E1B1EA676670629222D7629CFA532322D44A0577934B8BD5E9A141ECEBA2CACC258395DACDF6282FD7DD6617FFDAB77EEB99859B645871B14B8CF3826592AC9E2E8E0F048A8BA369F0A68CB38763C209A2E9541E3776CD4AA632E236E6B22758FAC97E02B8AEC170415AFBA0E1CFC7ABAF8B7751D7F0EDC5F137C623D4409B67E97CB92F5AA3956A0F0171FBDFE75A80CAC46A5364612534558318DA94FB92B106A9AA65441ED5EDDEAC9258354B652EE68E7EA55BD200215AA86823708095515A8BAC052569F72E84F22D411D0592C5C8DAA0B6ACA4A54E921D7B30E95CE39C6FA9F58C5C8F4F35EF3E12648D65049C840BC768C236927CA84CFF8D5DF86EB7F3D6643F7ACBB885A0E27D681A8593A1C9652719A5E822E17A03100675C64A6033F0C59D16567DC21167131D1F73244A0304B4F80B5622BD021D9A1D8CAB31722F3230D32FD34A4281FC68BD1F06716104BFDBF2CD13198DD0654E0180CF694876EF7B21B1D9867F49215532B30BE90851136D9D03177B6EBAECEC4B3EA663FB2454F603FEA046B8D8C86C618AB3CAA3D1EA76D733CC2B687068B4B000CB41EA0B4812575903B19CC1832D81EABD5E306AD38AB22C0A58A78B673C21C49AFB0C81EFBD865035A6743576499411E2F9069367DDD953193249B1E80CD2C4B57AFBA4A9EA2356AE9132917A95B698D4EBCA37AACBED39229DF689514F042B0DBEEED967F9A0E4A55979D7097C97E37DE989B7258972351EBEA7E2AD683EE7867AD1AE7C68A1328C91EBCA8F7786082B22B0D4F2366CD8EA0B7D180964E79A56F8815751EC67C938CD8722E4E6BCECD89E9C635F43AF35BEB43A40958CDAC16DA0C0E3BA0CCC8F415CFC6764B55EFEF67E696F6AA6B36335ECBEAC64C5EBE6C6C4E53BC169F19A375AC523697C26453F2574B5AC03C986BF2CA63726D06714FF92A54B9B553058B790B2D7BBA7BBA709E42BAE759B459516A46842C9D84D21C520F68B6AC343D5CF7479C1288F54A93027D9AA75514A012E72E634CD28C650B348FAA3A527B6933BDCA66CD6B53D4C3699A3B93F0C6A9B32ECD33C325555413B74CDA36A1DE64AA48886A43B5D817EE6B2C3D2A3185BB8194007ACA684C5C5F8EABC023B549876AE31D9022710FAE45386139396E6B6B35689A962B1C365C4EF6704B032BBBE9D58D53A4ED745B825648B33D236D4784296A47691206CE13DA81484C49A8E680A57695BD762E1A8A584DC7AD3AA96D678452F39451F659CF53662E44D95D09C241F40D678D29AA070C4F945D551C1C8424757B0D4E9DEF4F901D571804D187501F8508061505E53C4DEA6426017B909EFDBAC0B1BBA940AC28CC00DB9C7B59F6B90E9EC3C2CB15302ABA08AF9D6E30410ECB1CA63AEF19D98436B3849DF43FC54A932058DAD81376AE83BB846C1342978CFD278F7BA3CDBCE5A6F9D3B2893CCEABBBF4317F3CC412289A2E7BC37F17FC94B89E53E27D053CB35280606E789E00C1F692B04488CD5B09E9360C3401E5E42BA3070FD8DF7A14587C17ACD157DC0537CA7E1FF106D96FD5A3751590F68DE0C9BEBA70D126427E9CC3A8C6D39F94871DFFF587FF017594FEC4048A0000 , N'6.1.3-40302')

